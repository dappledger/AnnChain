language: go
go:
  - "1.12.8"
sudo: false
jobs:
  include:
    - stage: build
      os: linux
      go: 1.12.8
      before_install:
        - curl https://dl.google.com/go/go1.12.8.linux-amd64.tar.gz | tar -xz
        - mkdir $HOME/.gopkgs
        - export PATH=`pwd`/go/bin:$PATH
        - export GOROOT=`pwd`/go
        - export GOPATH=$HOME/.gopkgs
        - go get -t -v ./...
      before_script:
        - ./get_pkgs.sh && ./coverage.sh
        - make
      script:
        - go test ./... -coverprofile=coverage.txt -covermode=atomic
      after_success:
        - bash <(curl -s https://codecov.io/bash)
